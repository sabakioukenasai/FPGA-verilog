# FPGA-verilog

### 写在前面
本仓库包含了作者就读于HITSZ时完成的一些硬件实验的vivado项目文件。

作者是20级计科的学生，创建这个仓库一方面是想整理之前写过的代码，另一方面是想传递一下资源，希望学弟学妹们可以少走弯路。

完成这些实验时作者水平也有限，代码中可能有些疏漏。当然，所有工程整体上都是可用的（）。数字逻辑实验作者扣的分也不多；而计算机设计与实践本身就是考查课，作者也做到了流水线CPU的冒险处理，基本上可以满足大部分同学的需要。

所有的工程文件都是使用 **Vivado 2018.2** 的版本创建的，只要你安装了大于等于这个版本的 Vivado 就可以直接打开。（实验室的电脑安装的是**Vivado 2018.3**当然也可以打开这些工程项目）。

---

### 1 数字逻辑设计

刚刚接触硬件语言，大家可能会觉得很蒙、没有头绪，它和我们在大一学习的C语言有许多不同。我们会接触很多新的概念——延迟、毛刺、锁存、闭环等等。个人认为，理论课老师（可能不是所有老师都一样）关于verilog语言的讲解对我们完成实验帮助有限，真的很建议~学弟学妹们在做实验前通过其他途径学习verilog语法和硬件语言编程知识。提前做好准备，动手的时候才不会太被动。

学长也是这样一路走过来，刚开始写硬件语言的的时候很不适应，前几次做实验都是屡屡破防，天天加班。当然，后面熟悉了verilog语言后，也渐渐得心应手，能够在课上腾出一些时间完成实验报告。

我觉得 [**菜鸟教程 verilog**](https://www.runoob.com/w3cnote/verilog-tutorial.html) 关于这方面的讲解还是十分丰富，并且便于理解的！如果你能提前在这个网站上学习一些关于verilog的知识（不用学很多，学到6.6节对付实验就够了），那么上手实验时会感觉轻松很多。下图列出了一些可以略过的部分：

![](README/README1.png)

不同届可能做的实验可能不太一样，我们这一届，数字逻辑课程一共做了下面几个实验

![](README/README0.png)

实验与Vivado项目对应关系如下表所示:

|   实验标题				|  对应的项目文件 			|
| :-: | :-: |
| 3-8译码器的实现 		| decoder_38 				|
| 计数器设计(包含两项任务)| flowing_water_lights & holiday_lights |
| 利用IP设计电路 			| memory_w_r 				|
| 数码管控制器设计 		| led_display_ctrl 			|
| 序列检测器设计 			| sequence_detection 		|
| 16进制计算器设计 		| calculator_hex 			|

**温馨提示：不同届即使是同名实验也有可能在细微处有差异，具体标准以教师提供的实验网站为准，请各位学弟学妹在食用时，反复确认本代码符合实验手册要求。**

*附实验网址：* [HITSZ-2021秋季 数字逻辑设计](https://hitsz-cslab.gitee.io/diglogic/)

---

### 2 计算机设计与实践

这门课开设与夏季小学期，是一门考察课。实验每年变化不大，都是用verilog语言实现CPU。

实验分为两个部分（其实还有一道开胃小菜，这里就不提了）：设计单周期CPU和设计流水线CPU。其中流水线CPU又分为理想流水线CPU和解决冲突冒险的流水线CPU。只要做单周期CPU完全正确就能及格，但是增加容错，一般大家都会多做一个理想流水线。实验要求我们的CPU必须运行RSIC-V的24条必备指令，有能力的同学可以挑战37条RISC-V指令。(作者只写了24条啦

单周期CPU俺是全部完成的，流水线CPU也是几乎完成的。几乎的意思是，解决了冲突冒险，完成了trace测试（这个你们做到实验了会懂的），但是下板的时候有瑕疵。

#### 2.1 令我受益的开发方法

做完实验后觉得，老师当时要求我们填写数据通路表和控制信号表、绘制模块设计图的决定是十分正确的。在开始实现CPU之前，我们会填写数据通路表和控制信号表以及绘制CPU整体框图，这些准备工作有助于我们理清数据流动的路线以及各个控制信号的来源！。使用代码实现CPU的某一阶段前，我们都会先画好这一阶段的框图，这样做可以帮助你理清该阶段每个模块的功能和布线要求。**表填好里，图画好了，写代码的时候就有底气、有参照！**

#### 2.2 绘图软件和实验网站

绘图使用的软件可以从此处下载，**真的~十分好用，墙推！！！** [draw.io](https://github.com/jgraph/drawio-desktop/releases/tag/v15.4.0)

如果已经装了微软全家桶，也可以使用他家的visio。

*附实验网站：* [HITSZ-2022夏季 计算机设计与实践](https://hitsz-cslab.gitee.io/cpu/)

#### 2.3 发挥主观能动性:dog:

所有代码、表格、图片资源包括实验报告都已附上，作者希望仅仅希望这些资源是你们完成实验一个参考，并不希望大家做实验时放弃独立思考和创造。因为每个人的设计不同，控制信号表、整体框图都会有所差异，老师在查重方面也是比较严格，大家也要稍微自力更生一下(: 

**如果大家不把内部原理弄清楚，在写代码和验收的时候都会很痛苦。老师会询问你CPU的实现细节，如果代码能过，但是你回答不上老师的问题，就会很尴尬。**

#### 2.4 使用说明

- **中文注释乱码问题**。因为我不是很喜欢使用vivado的文本编辑器，所以我的实验代码是使用sublime写的。由于编码原因，我提供的文件在vivado中打开后中文注释全部变成了乱码，建议大家配合VScode等第三方编辑器食用~~。我个人比较喜欢的开发方式是，使用第三方编辑器编写代码，使用vivado检查代码语法。
- **代码与实验报告、整体框图不符合的问题**。正如前面所言，整体框图是先于代码绘制的。但是，在实现的过程中，我们可能发现了更加精简的方案，所以最后展示的代码与包括实验报告内的框图有所出入。因为画图耗时确实有点久（加上我也懒~），所有这些图片就没有随着代码的改变而更新。。。分析各个阶段功能的时候是按照整体框图的内容解释的；波形分析的时候，是按照代码仿真时的波形来分析的。
- **可以发挥你的智慧**。如果朋友发现我的代码有不完善的、可改进的地方，可以私信我，或者在上github push一份你做出修改的commit，我收到后会核查修改的合理性和必要性，如果你的提案被采纳，我会将你的github首页放入致谢名单中。希望大家可以共同进步！

---

### 3 致谢名单

我们感谢以下用户为完善本仓库做出的贡献：

<center><font size=4><strong>
	<a href="https://github.com/sabakioukenasai/FPGA-verilog.git">期待你贡献的方案</a>
</strong></font></center>